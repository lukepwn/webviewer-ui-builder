/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[22],{687:function(wa,ua,e){e.r(ua);var la=e(0),oa=e(7),na=e(2);wa=e(49);var ja=e(39),ia=e(21);e=function(){function ca(){this.init()}ca.prototype.init=function(){this.Aza=!1;this.Xh=this.Cq=this.connection=null;this.Yk={};this.ga=this.OS=null};ca.prototype.uD=function(x){for(var y=this,n=0;n<x.length;++n){var h=x[n];switch(h.at){case "create":this.Yk[h.author]||(this.Yk[h.author]=h.aName);this.XMa(h);break;case "modify":this.ga.vu(h.xfdf).then(function(f){y.ga.Lb(f[0])});
break;case "delete":h="<delete><id>".concat(h.aId,"</id></delete>"),this.ga.vu(h)}}};ca.prototype.XMa=function(x){var y=this;this.ga.vu(x.xfdf).then(function(n){n=n[0];n.authorId=x.author;y.ga.Lb(n);y.ga.trigger(oa.d.UPDATE_ANNOTATION_PERMISSION,[n])})};ca.prototype.ILa=function(x,y,n){this.Cq&&this.Cq(x,y,n)};ca.prototype.preloadAnnotations=function(x){this.addEventListener("webViewerServerAnnotationsEnabled",this.ILa.bind(this,x,"add",{imported:!1}),{once:!0})};ca.prototype.initiateCollaboration=
function(x,y,n){var h=this;if(x){h.Xh=y;h.ga=n.ka();n.addEventListener(oa.i.DOCUMENT_UNLOADED,function(){h.disableCollaboration()});h.p3a(x);var f=new XMLHttpRequest;f.addEventListener("load",function(){if(200===f.status&&0<f.responseText.length)try{var r=JSON.parse(f.responseText);h.connection=exports.da.V4a(Object(ja.l)(h.Xh,"blackbox/"),"annot");h.OS=r.id;h.Yk[r.id]=r.user_name;h.ga.v3(r.id);h.connection.f9a(function(b){b.t&&b.t.startsWith("a_")&&b.data&&h.uD(b.data)},function(){h.connection.send({t:"a_retrieve",
dId:x});h.trigger(ca.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[h.Yk[r.id],h.OS])},function(){h.disableCollaboration()})}catch(b){Object(na.g)(b.message)}});f.open("GET",Object(ja.l)(this.Xh,"demo/SessionInfo.jsp"));f.withCredentials=!0;f.send();h.Aza=!0;h.ga.tla(function(r){return h.Yk[r.Author]||r.Author})}else Object(na.g)("Document ID required for collaboration")};ca.prototype.disableCollaboration=function(){this.Cq&&(this.ga.removeEventListener(ia.a.Events.ANNOTATION_CHANGED,this.Cq),this.Cq=
null);this.connection&&this.connection.Mw();this.ga&&this.ga.v3("Guest");this.init();this.trigger(ca.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};ca.prototype.p3a=function(x){var y=this;this.Cq&&this.ga.removeEventListener(ia.a.Events.ANNOTATION_CHANGED,this.Cq);this.Cq=function(n,h,f){return Object(la.c)(this,void 0,void 0,function(){var r,b,a,w,aa,z,fa,ea,ha;return Object(la.e)(this,function(ba){switch(ba.label){case 0:if(f.imported)return[2];r={t:"a_".concat(h),dId:x,annots:[]};return[4,y.ga.Yba()];
case 1:b=ba.aa();"delete"!==h&&(a=(new DOMParser).parseFromString(b,"text/xml"),w=new XMLSerializer);for(aa=0;aa<n.length;aa++)z=n[aa],ea=fa=void 0,"add"===h?(fa=a.querySelector('[name="'.concat(z.Id,'"]')),ea=w.serializeToString(fa),ha=null,z.InReplyTo&&(ha=y.ga.Kf(z.InReplyTo).authorId||"default"),r.annots.push({at:"create",aId:z.Id,author:y.OS,aName:y.Yk[y.OS],parent:ha,xfdf:"<add>".concat(ea,"</add>")})):"modify"===h?(fa=a.querySelector('[name="'.concat(z.Id,'"]')),ea=w.serializeToString(fa),
r.annots.push({at:"modify",aId:z.Id,xfdf:"<modify>".concat(ea,"</modify>")})):"delete"===h&&r.annots.push({at:"delete",aId:z.Id});0<r.annots.length&&y.connection.send(r);return[2]}})})}.bind(y);this.ga.addEventListener(ia.a.Events.ANNOTATION_CHANGED,this.Cq)};ca.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return ca}();Object(wa.b)(e);ua["default"]=e}}]);}).call(this || window)
